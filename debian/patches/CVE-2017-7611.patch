From 9a0d9d314a6342b56e3277bd7ad7ecb6e73a7d38 Mon Sep 17 00:00:00 2001
From: Mark Wielaard <mark@klomp.org>
Date: Mon, 27 Mar 2017 23:59:02 +0200
Subject: [PATCH] elflint: Check symbol table data is big enough before
 checking.

Before checking symbol index zero we should make sure the data size
is big enough.

https://sourceware.org/bugzilla/show_bug.cgi?id=21310

Signed-off-by: Mark Wielaard <mark@klomp.org>

Index: elfutils-0.166/src/elflint.c
===================================================================
--- elfutils-0.166.orig/src/elflint.c
+++ elfutils-0.166/src/elflint.c
@@ -1972,7 +1972,8 @@ section [%2d] '%s': extended section ind
       return;
     }
 
-  if (*((Elf32_Word *) data->d_buf) != 0)
+  if (data->d_size < sizeof (Elf32_Word)
+      || *((Elf32_Word *) data->d_buf) != 0)
     ERROR (gettext ("symbol 0 should have zero extended section index\n"));
 
   for (size_t cnt = 1; cnt < data->d_size / sizeof (Elf32_Word); ++cnt)
